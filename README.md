# Habbits

Personal habit & life tracking system.

Веб-приложение для трекинга привычек с интеграцией Notion Database.

## Структура проекта

- `index.html` - главная страница приложения
- `styles.css` - стили интерфейса
- `app.js` - основная логика приложения
- `notion-api.js` - утилиты для работы с Notion API
- `server.py` - прокси-сервер для обхода CORS (Python/Flask)
- `requirements.txt` - зависимости проекта (Python)
- `render.yaml` - конфигурация для деплоя на Render
- `.env.example` - пример файла с переменными окружения

## Настройка

### 1. Создание интеграции в Notion

1. Перейдите на https://www.notion.so/my-integrations
2. Нажмите "+ New integration"
3. Укажите название (например, "Habits Tracker")
4. Выберите рабочее пространство (workspace)
5. Скопируйте **Internal Integration Token** (токен начинается с `secret_`)

### 2. Создание базы данных в Notion

#### База данных для привычек

Создайте новую базу данных в Notion со следующими свойствами:

- **Habit** (Title) - название привычки
- **Date** (Date) - дата записи
- **Completed** (Checkbox) - выполнена ли привычка

**Важно:** Имена свойств должны точно совпадать (чувствительны к регистру)!

#### База данных для вопросов об энергии (опционально)

Создайте отдельную базу данных в Notion для вопросов об уровне энергии со следующими свойствами:

- **Вопрос** (Title) - текст вопроса
- **Дата** (Date) - дата ответа
- **Ответ** (Select) - выбранный вариант ответа

**Варианты для поля "Ответ" (Select):**
1. Выжат, апатия
2. Тяжело
3. Норм
4. Хорошо
5. Очень хорошо

**Важно:** 
- Имена свойств должны точно совпадать (чувствительны к регистру)!
- Варианты ответов должны точно совпадать с указанными выше
- После создания базы данных скопируйте её ID и добавьте в `database-config.js` как `ENERGY_DATABASE_ID`

### 3. Подключение интеграции к базе данных

1. Откройте созданную базу данных в Notion
2. Нажмите на "..." (три точки) в правом верхнем углу
3. Выберите "Connections" → "Add connections"
4. Найдите вашу интеграцию и подключите её

### 4. Получение ID базы данных

1. Откройте базу данных в Notion
2. Скопируйте URL из адресной строки
3. ID базы данных - это часть URL между последним `/` и `?` (или до конца, если нет параметров)
   
   Пример URL: `https://www.notion.so/your-workspace/a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6?v=...`
   ID: `a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6`

4. **Для базы данных энергии:** Повторите шаги 1-3 для базы данных вопросов об энергии и добавьте ID в `database-config.js`:
   ```javascript
   ENERGY_DATABASE_ID: 'ваш_id_базы_данных_энергии',
   ```

## Деплой на Render

### Быстрый старт

1. **Подключите репозиторий к Render:**
   - Зайдите на https://render.com
   - Нажмите "New +" → "Web Service"
   - Подключите ваш GitHub/GitLab репозиторий

2. **Настройте сервис:**
   - **Name**: `habbits-tracker` (или любое другое имя)
   - **Runtime**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python server.py`

3. **Добавьте переменные окружения:**
   - Перейдите в раздел "Environment"
   - Добавьте переменные:
     - `NOTION_TOKEN` - ваш токен интеграции Notion
     - `DATABASE_ID` - ID вашей базы данных
     - `PORT` - автоматически устанавливается Render (можно оставить по умолчанию)

4. **Деплой:**
   - Нажмите "Create Web Service"
   - Render автоматически запустит сборку и деплой
   - После успешного деплоя вы получите URL приложения

### Использование render.yaml

Если вы используете `render.yaml`, Render автоматически настроит сервис:

1. Подключите репозиторий к Render
2. Выберите "New Blueprint Instance"
3. Render автоматически обнаружит `render.yaml` и предложит создать сервис
4. Добавьте переменные окружения `NOTION_TOKEN` и `DATABASE_ID` в настройках сервиса

## Локальная разработка

### Требования

- Python 3.9+ (рекомендуется Python 3.11)
- pip (менеджер пакетов Python)

### Установка

1. **Клонируйте репозиторий:**
   ```bash
   git clone <your-repo-url>
   cd habbits
   ```

2. **Создайте виртуальное окружение (рекомендуется):**
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # На Windows: venv\Scripts\activate
   ```

3. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Настройте переменные окружения:**
   
   Создайте файл `.env` на основе `.env.example`:
   ```bash
   cp .env.example .env
   ```
   
   Откройте `.env` и заполните значения:
   ```
   NOTION_TOKEN=ваш_токен_здесь
   DATABASE_ID=ваш_id_базы_данных_здесь
   PORT=3000
   ```

5. **Запустите сервер:**
   ```bash
   python server.py
   ```

6. **Откройте в браузере:**
   ```
   http://localhost:3000
   ```

### Использование переменных окружения

Приложение использует переменные окружения для конфигурации. Вы можете установить их:

- **Через .env файл** (для локальной разработки)
- **Через переменные окружения системы** (для продакшена)

## Использование

1. Откройте приложение в браузере
2. Отмечайте выполненные привычки тумблерами
3. Для "Deep work sessions" и "Learning sessions" используйте каунтер (+ и -)
4. Ответьте на вопрос об уровне энергии (выберите один из вариантов)
5. Нажмите "Отправить" для сохранения данных в Notion
6. Все привычки и ответ на вопрос будут записаны в ваши Notion базы данных

## Особенности

- Автоматическое отображение всех привычек по категориям
- Тумблеры для обычных привычек
- Каунтеры для привычек с множественными сессиями (Deep work sessions, Learning sessions)
- Вопрос дня об уровне энергии и интереса к жизни
- Современный и отзывчивый интерфейс
- Прокси-сервер для обхода ограничений CORS Notion API
- Готов к деплою на Render

## Безопасность

⚠️ **ВАЖНО:** 
- Никогда не коммитьте файл `.env` или `config.js` с реальными токенами в публичный репозиторий!
- Используйте переменные окружения для секретов
- Файл `.env` уже добавлен в `.gitignore`

## Устранение проблем

### Ошибка "Не установлены переменные окружения"

Убедитесь, что переменные `NOTION_TOKEN` и `DATABASE_ID` установлены:
- На Render: в настройках сервиса → Environment
- Локально: в файле `.env` или через переменные окружения системы

### Ошибка при подключении к Notion API

- Проверьте, что токен правильный
- Убедитесь, что интеграция подключена к базе данных в Notion
- Проверьте, что ID базы данных указан правильно

### Приложение не открывается на Render

- Проверьте логи сервиса на Render
- Убедитесь, что переменные окружения установлены
- Проверьте, что порт настроен правильно (Render использует переменную PORT)
